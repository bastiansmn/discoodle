(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["messages/:id"],{"677b":function(e,t,n){"use strict";n("6d01")},"6d01":function(e,t,n){},"8aef":function(e,t,n){"use strict";n("4de4"),n("caad"),n("2532"),n("d81d");var s=n("7a23"),o=Object(s["withScopeId"])("data-v-3c631f8d");Object(s["pushScopeId"])("data-v-3c631f8d");var r={class:"content"},i=Object(s["createTextVNode"])(" Quel(s) utilisateur(s) voulez-vous ajouter ? "),c={class:"users"},a={style:{width:"calc(100% - 85px)"}},d={class:"input-user"},u={key:0,id:"friends-list"};Object(s["popScopeId"])();var l=o((function(e,t,n,o,l,m){return Object(s["openBlock"])(),Object(s["createBlock"])("div",{class:"AddUserInConv",onClick:t[5]||(t[5]=function(){return m.clickEvent&&m.clickEvent.apply(m,arguments)})},[Object(s["createVNode"])("div",r,[i,Object(s["createVNode"])("div",c,[(Object(s["openBlock"])(!0),Object(s["createBlock"])(s["Fragment"],null,Object(s["renderList"])(l.usersToAdd,(function(e){return Object(s["openBlock"])(),Object(s["createBlock"])("div",{key:e,class:"userInfo"},[Object(s["createVNode"])("div",null,Object(s["toDisplayString"])(null===e||void 0===e?void 0:e.charAt(0).toUpperCase()),1),Object(s["createVNode"])("span",a,Object(s["toDisplayString"])(e),1),Object(s["createVNode"])("button",{class:"close",onClick:function(t){return m.removeUser(e)}},"X",8,["onClick"])])})),128))]),Object(s["createVNode"])("div",d,[Object(s["createVNode"])("input",{type:"text",placeholder:"Entrez un nom d'utilisateur...",autocomplete:"off",list:"friends-list",name:"name_room",onKeypress:t[1]||(t[1]=function(){return m.isEnter&&m.isEnter.apply(m,arguments)})},null,32),n.showAutocomplete?(Object(s["openBlock"])(),Object(s["createBlock"])("datalist",u,[(Object(s["openBlock"])(!0),Object(s["createBlock"])(s["Fragment"],null,Object(s["renderList"])(e.getFriends.filter((function(e){return!l.users.map((function(e){return e.username})).includes(e.username)})),(function(e){return Object(s["openBlock"])(),Object(s["createBlock"])("option",{key:e.id,value:e.username},null,8,["value"])})),128))])):Object(s["createCommentVNode"])("",!0),Object(s["createVNode"])("button",{onClick:t[2]||(t[2]=function(){return m.addUser&&m.addUser.apply(m,arguments)})}," + ")]),Object(s["createVNode"])("button",{class:"submit",onClick:t[3]||(t[3]=function(t){e.$emit("addUsers",l.usersToAdd)})}," Ajouter les utilisateurs séléctionnés ! "),Object(s["createVNode"])("button",{class:"closePopUp",onClick:t[4]||(t[4]=function(t){return e.$emit("desactivatePopUp")})}," X ")])])})),m=n("5530"),p=n("5502"),g=n("bc3a"),f=n.n(g),h={name:"AddUserInConv",props:{showAutocomplete:{required:!0,type:Boolean}},methods:{clickEvent:function(e){"AddUserInConv"===e.target.className&&this.$emit("desactivatePopUp")},addUser:function(){var e=document.querySelector(".input-user > input").value;""===e||this.usersToAdd.includes(e)||this.usersToAdd.push(e),document.querySelector(".input-user > input").value=""},removeUser:function(e){this.usersToAdd=this.usersToAdd.filter((function(t){return t!==e}))},isEnter:function(e){13===e.keyCode&&this.addUser()}},data:function(){return{usersToAdd:[],users:[]}},computed:Object(m["a"])({},Object(p["c"])(["getFriends","getCurrentConv"])),mounted:function(){var e=this;""!==this.getCurrentConv&&f.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data}))}};n("a795");h.render=l,h.__scopeId="data-v-3c631f8d";t["a"]=h},9050:function(e,t,n){"use strict";n.r(t);n("b0c0");var s=n("7a23"),o=Object(s["withScopeId"])("data-v-f9f75fbe");Object(s["pushScopeId"])("data-v-f9f75fbe");var r={class:"conv-info"},i={style:{"font-size":"23px","font-weight":"500",color:"#F4F4F4"}},c={class:"top-right-buttons"},a=Object(s["createVNode"])("img",{src:"../assets/pin.png",alt:"",style:{height:"60%"}},null,-1),d=Object(s["createVNode"])("img",{src:"../assets/user.svg",alt:"",style:{width:"25px"}},null,-1),u={class:"user-list"},l=Object(s["createVNode"])("span",{style:{"font-size":"18px",color:"#F4F4F4","font-weight":"600","margin-bottom":"10px"}},"Utilisateur(s) de la room :",-1),m={key:0,src:"../assets/crown.svg",style:{height:"80%","margin-right":"10px"},alt:""},p=Object(s["createVNode"])("img",{src:"../assets/crown.svg",style:{height:"70%"},alt:""},null,-1),g={key:0,class:"pinned-message"},f=Object(s["createVNode"])("br",null,null,-1),h=Object(s["createVNode"])("br",null,null,-1),b={class:"conv-messages"},v={key:0,style:{"align-self":"center","font-size":"15px","font-weight":"500",color:"#F4F4F4"}},O={class:"conv-input"},j={class:"right-side-input"},y=Object(s["createVNode"])("img",{src:"../assets/happy.svg",alt:"Smiley"},null,-1),C={class:"submit-file",style:{cursor:"pointer"}},k=Object(s["createTextVNode"])(" + ");Object(s["popScopeId"])();var N=o((function(e,t,n,N,U,w){var _=Object(s["resolveComponent"])("w-drawer"),E=Object(s["resolveComponent"])("AddUser"),V=Object(s["resolveComponent"])("Message"),A=Object(s["resolveComponent"])("EmojiPicker");return Object(s["openBlock"])(),Object(s["createBlock"])("div",{class:"ChatContent",key:e.$route.fullPath},[Object(s["createVNode"])("div",r,[Object(s["createVNode"])("div",null,[Object(s["createVNode"])("span",i,Object(s["toDisplayString"])(e.$route.query.name),1),Object(s["createVNode"])("div",c,[Object(s["createVNode"])("button",{style:[U.pinAdd?{animation:""}:{animation:"none"},{height:"100%"}],onClick:t[1]||(t[1]=function(){return w.switchPinDisplay&&w.switchPinDisplay.apply(w,arguments)})},[a],4),Object(s["createVNode"])("button",{style:{color:"#F4F4F4","font-size":"33px","font-weight":"500",height:"100%"},onClick:t[2]||(t[2]=function(e){return U.showAddUser=!0})}," + "),Object(s["createVNode"])("button",{style:{cursor:"pointer"},onClick:t[3]||(t[3]=function(e){U.showUserList=!0})},[d]),Object(s["createVNode"])(_,{modelValue:U.showUserList,"onUpdate:modelValue":t[4]||(t[4]=function(e){return U.showUserList=e}),right:"",width:"350px","bg-color":"grey-dark5"},{default:o((function(){return[Object(s["createVNode"])("div",u,[l,(Object(s["openBlock"])(!0),Object(s["createBlock"])(s["Fragment"],null,Object(s["renderList"])(U.users,(function(t){return Object(s["openBlock"])(),Object(s["createBlock"])("div",{key:t.id,class:"user"},[t.id===U.roomAdminID?(Object(s["openBlock"])(),Object(s["createBlock"])("img",m)):Object(s["createCommentVNode"])("",!0),Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(t.username)+" ",1),Object(s["createVNode"])("div",null,[t.id!==e.getUser.id&&e.getUser.id===U.roomAdminID?(Object(s["openBlock"])(),Object(s["createBlock"])("button",{key:0,style:{"margin-right":"6px"},onClick:function(e){return w.promoteAdmin(t.id)}},[p],8,["onClick"])):Object(s["createCommentVNode"])("",!0),e.getUser.id===U.roomAdminID&&t.id!==e.getUser.id&&t.id!==U.roomAdminID?(Object(s["openBlock"])(),Object(s["createBlock"])("button",{key:1,onClick:function(e){return w.removerUser(t.id)}}," X ",8,["onClick"])):Object(s["createCommentVNode"])("",!0)])])})),128))])]})),_:1},8,["modelValue"]),U.showAddUser?(Object(s["openBlock"])(),Object(s["createBlock"])(E,{key:0,onAddUsers:w.addUsers,onDesactivatePopUp:t[5]||(t[5]=function(e){U.showAddUser=!1}),"show-autocomplete":!0},null,8,["onAddUsers"])):Object(s["createCommentVNode"])("",!0)]),U.showPinned?(Object(s["openBlock"])(),Object(s["createBlock"])("div",g,[Object(s["createVNode"])("div",null,[Object(s["createTextVNode"])(Object(s["toDisplayString"])(0===U.pinned.length?"Aucun message épinglé":"")+" ",1),(Object(s["openBlock"])(!0),Object(s["createBlock"])(s["Fragment"],null,Object(s["renderList"])(U.pinned,(function(e){return Object(s["openBlock"])(),Object(s["createBlock"])("div",{class:"pinned-message-content",key:e},[Object(s["createTextVNode"])(Object(s["toDisplayString"])(e.sender)+" : ",1),f,Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(e.content)+" ",1),h,Object(s["createVNode"])("button",{class:"unpin-message",onClick:function(t){return w.unpinMessage(e.message_id)}}," X ",8,["onClick"])])})),128))])])):Object(s["createCommentVNode"])("",!0)])]),Object(s["createVNode"])("div",b,[0===U.messages.length?(Object(s["openBlock"])(),Object(s["createBlock"])("span",v," Soyez le premier à envoyer un message à "+Object(s["toDisplayString"])(e.$route.query.name),1)):Object(s["createCommentVNode"])("",!0),(Object(s["openBlock"])(!0),Object(s["createBlock"])(s["Fragment"],null,Object(s["renderList"])(U.messages,(function(t){return Object(s["openBlock"])(),Object(s["createBlock"])(V,{key:t,content:t.content,sender:t.sender,belong_to_myself:t.sender===e.getUser.username,message_date:t.message_date,message_id:t.message_id,edited:t.edited,onPinnedMessage:w.pinnedMessage,onDeletedMessage:w.deletedMessage,onEditedMessage:w.editedMessage},null,8,["content","sender","belong_to_myself","message_date","message_id","edited","onPinnedMessage","onDeletedMessage","onEditedMessage"])})),128))]),Object(s["createVNode"])("div",O,[Object(s["createVNode"])("span",null,Object(s["toDisplayString"])(w.getWritersAsText()),1),Object(s["createVNode"])("div",null,[Object(s["createVNode"])("input",{type:"text",autocomplete:"off",placeholder:"Envoyer un message à ".concat(e.$route.query.name),onKeydown:t[6]||(t[6]=function(){return w.actionInput&&w.actionInput.apply(w,arguments)})},null,40,["placeholder"]),Object(s["createVNode"])("div",j,[U.showEmoji?(Object(s["openBlock"])(),Object(s["createBlock"])(A,{key:0,onSelectedEmoji:w.insertEmoji,onCloseEmoji:t[7]||(t[7]=function(e){return U.showEmoji=!1}),class:"emojiPicker"},null,8,["onSelectedEmoji"])):Object(s["createCommentVNode"])("",!0),Object(s["createVNode"])("button",{style:{height:"32px",width:"32px"},onClick:t[8]||(t[8]=function(e){return U.showEmoji=!U.showEmoji})},[y]),Object(s["createVNode"])("label",C,[k,Object(s["createVNode"])("input",{type:"file",ref:"uploadImage",onChange:t[9]||(t[9]=function(e){return w.uploadImage()}),style:{height:"0",width:"0"}},null,544)])])])])])})),U=n("5530"),w=n("2909"),_=n("b85c"),E=n("1da1"),V=(n("96cf"),n("a9e3"),n("159b"),n("99af"),n("caad"),n("2532"),n("4de4"),n("ac1f"),n("5319"),n("a434"),n("a1f0"),n("cc7d")),A=n.n(V),D=n("74d1"),S=n.n(D),B=n("5502"),I=n("bc3a"),M=n.n(I),x=n("0e54"),T=n.n(x),F=n("d99d"),P=n("4bdc"),R=n("a289"),J=n("8aef"),L=null,q={name:"ChatContent",components:{AddUser:J["a"],EmojiPicker:R["a"],Message:F["a"]},data:function(){return{messages:[],users:[],pinned:[],writers:[],showPinned:!1,showEmoji:!1,pinAdd:!1,showAddUser:!1,showUserList:!1,roomAdminID:Number}},mounted:function(){var e=this;this.getMessagesFromJSON(),this.connect(),this.getUserOfRoom(),M.a.get("/api/rooms/findAdminOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.roomAdminID=t.data.id}))},beforeRouteUpdate:function(){var e=this;this.disconnect(),this.getMessagesFromJSON(),this.getUserOfRoom(),this.connect(),M.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data})),M.a.get("/api/rooms/findAdminOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.roomAdminID=t.data.id}))},unmounted:function(){this.disconnect()},methods:{getWritersAsText:function(){var e=this;if(0===this.writers.length)return"";if(1===this.writers.length)return"".concat(this.writers[0]," est en train d'écrire...");if(this.writers.length>4)return"Plusieurs personnes sont en train d'écrire";var t="";return this.writers.forEach((function(n){t+=n===e.writers[e.writers.length-1]?"et ".concat(n):"".concat(n).concat(n===e.writers[e.writers.length-2]?"":","," ")})),"".concat(t," sont en train d'écrire...")},actionInput:function(e){if(13===e.keyCode&&""!==document.querySelector(".conv-input > div > input").value)this.send(),this.writers.pop(this.getUser.username);else if(13!==e.keyCode){this.writing();var t=document.querySelector(".conv-input > div > input");t.value=this.displayMessage(t.value,!1,!0,!1)}},getUserOfRoom:function(){var e=this;M.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data}))},writing:function(){this.writers.includes(this.getUser.username)||L.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({sender:this.getUser.username,type:"WRITING"}))},connect:function(){var e=this,t=new A.a("/ws");L=S.a.over(t),L.connect({},(function(){L.subscribe("/conversations/rooms/".concat(e.getCurrentConv),(function(t){e.onMessageReceived(t)}))}),this.errorCallBack)},disconnect:function(){null!==L&&L.disconnect()},errorCallBack:function(){var e=this;setTimeout((function(){e.connect()}),5e3)},onMessageReceived:function(e){var t=this,n=JSON.parse(e.body);n.sender!==this.getUser.username&&("MESSAGE"===n.type?this.messages.unshift({convUUID:n.convUUID,message_id:n.message_id,content:n.content,sender:n.sender,message_date:n.message_date,pinned:n.pinned,edited:!1}):"WRITING"===n.type?this.writers.includes(n.sender)||(this.writers.push(n.sender),setTimeout((function(){t.writers.pop(n.sender)}),5e3)):"PINNED"===n.type?this.messages.forEach((function(e){e.message_id!==n.message_id||t.pinned.includes(e)||t.pinned.push(e)})):"UNPINNED"===n.type?this.pinned=this.pinned.filter((function(e){return e.message_id!==n.message_id})):"DELETED"===n.type?(this.messages=this.messages.filter((function(e){return e.message_id!==n.message_id})),this.pinned=this.pinned.filter((function(e){return e.message_id!==n.message_id}))):"EDITED"===n.type?(this.messages.forEach((function(e){e.message_id===n.message_id&&(e.content=n.content,e.edited=!0)})),this.pinned.forEach((function(e){e.message_id===n.message_id&&(e.content=n.content,e.edited=!0)}))):"USERS_ADDED"===n.type?(n.users.forEach((function(e){t.containUsername(e)&&M.a.get("/api/users/findByUserName?username=".concat(e)).then((function(e){t.users.push(e.data)}))})),setTimeout((function(){t.getUserOfRoom()}),500),this.showAddUser=!1):"USER_REMOVED"===n.type?(this.users=this.users.filter((function(e){return e.id!==n.user_id})),setTimeout((function(){t.getUserOfRoom()}),500),n.user_id===this.getUser.id&&location.replace("/messages")):"CHANGE_ADMIN"===n.type&&(this.roomAdminID=n.user_id))},send:function(){var e=this,t=document.querySelector(".conv-input > div > input");t&&L&&M.a.post("/api/messages/sendMessage?room_uuid=".concat(this.getCurrentConv),{conv_uuid:this.getCurrentConv,content:t.value,sender:this.getUser.username,message_date:Date.now()}).then((function(n){e.messages.unshift(n.data),L.send("/conversations/rooms/".concat(e.getCurrentConv),{},JSON.stringify(n.data)),t.value=""}))},getMessagesFromJSON:function(){var e=this;M.a.get("/api/messages?room_uuid=".concat(this.getCurrentConv)).then((function(t){e.messages=t.data.sort((function(e,t){return t.message_date-e.message_date})),e.pinned=e.messages.filter((function(e){return!0===e.pinned}))}))},switchPinDisplay:function(){this.showPinned=!this.showPinned},unpinMessage:function(e){var t=this;M.a.put("/api/messages/unpinMessage?message_id=".concat(e)).then((function(){var n=0;t.pinned.forEach((function(s){s.message_id===e&&t.pinned.splice(n,1),n++})),L.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({message_id:e,type:"UNPINNED"}))}))},pinnedMessage:function(e){var t=this;this.messages.forEach((function(n){n.message_id!==e||t.pinned.includes(n)||(L.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({message_id:e,type:"PINNED"})),t.pinned.push(n))}))},deletedMessage:function(e){L.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({message_id:e,type:"DELETED"}))},editedMessage:function(e,t){L.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({message_id:e,content:t,type:"EDITED"}))},addUsers:function(e){var t=this;return Object(E["a"])(regeneratorRuntime.mark((function n(){var s,o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:s=Object(_["a"])(e),n.prev=1,s.s();case 3:if((o=s.n()).done){n.next=10;break}if(r=o.value,!t.containUsername(r)){n.next=8;break}return n.next=8,M.a.get("/api/users/findByUserName?username=".concat(r)).then((function(e){M.a.post("/api/rooms/addNewMember?room_id=".concat(t.getCurrentConv,"&user_id=").concat(e.data.id))}));case 8:n.next=3;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](1),s.e(n.t0);case 15:return n.prev=15,s.f(),n.finish(15);case 18:L.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({users:e,type:"USERS_ADDED"}));case 19:case"end":return n.stop()}}),n,null,[[1,12,15,18]])})))()},removerUser:function(e){M.a.delete("/api/rooms/removeMember?room_id=".concat(this.getCurrentConv,"&user_id=").concat(e)),L.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({user_id:e,type:"USER_REMOVED"}))},promoteAdmin:function(e){M.a.put("/api/rooms/changeAdmin?room_id=".concat(this.getCurrentConv,"&admin=").concat(e)),L.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({user_id:e,type:"CHANGE_ADMIN"}))},uploadImage:function(){var e=this,t=this.$refs.uploadImage.files[0],n=new FormData;n.append("file",t),M()({url:"/api/uploadfile/uploadImageInChat?room_id=".concat(this.getCurrentConv),method:"POST",data:n,headers:{Accept:"application/json","Content-type":"multipart/form-data"}}).then((function(t){"L'extension n'est pas un fichier jpg ou png, il ne peut donc pas être upload"!==t.data&&"Erreur lors du téléchargement de l'image !"!==t.data&&M.a.post("/api/messages/sendMessage?room_uuid=".concat(e.getCurrentConv),{conv_uuid:e.getCurrentConv,content:"![".concat("Image de "+e.getUser.username,"](").concat(t.data,")"),sender:e.getUser.username,message_date:Date.now()}).then((function(t){e.messages.unshift(t.data),L.send("/conversations/rooms/".concat(e.getCurrentConv),{},JSON.stringify(t.data))}))}))},filterEmoji:function(e){var t=":[a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*:",n=Object(w["a"])(e.matchAll(t));return n&&n.length>0&&n.forEach((function(t){P["a"][t[0].replaceAll(":","")]&&(e=e.replace(t[0],P["a"][t[0].replaceAll(":","")]))})),e},filterMarkdown:function(e){return T()(e)},filterPing:function(e){return e.includes("@".concat(this.getUser.username))?(this.mention=!0,e.replaceAll("@".concat(this.getUser.username),"@".concat(this.getUser.name))):e},displayMessage:function(e,t,n,s){return s&&(e=this.filterPing(e)),n&&(e=this.filterEmoji(e)),t&&(e=this.filterMarkdown(e)),e},insertEmoji:function(e){document.querySelector(".conv-input > div > input").value+=e},containUsername:function(e){var t=!1;return this.getFriends.forEach((function(n){n.username===e&&(t=!0)})),t}},computed:Object(U["a"])({},Object(B["c"])(["getColors","getCurrentConv","getUser","getFriends"]))};n("677b");q.render=N,q.__scopeId="data-v-f9f75fbe";t["default"]=q},a795:function(e,t,n){"use strict";n("a7d2")},a7d2:function(e,t,n){},d81d:function(e,t,n){"use strict";var s=n("23e7"),o=n("b727").map,r=n("1dde"),i=r("map");s({target:"Array",proto:!0,forced:!i},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=:id.87315b74.js.map