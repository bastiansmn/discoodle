(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["messages/:id"],{"493e":function(e,t,n){"use strict";n("a981")},"8aef":function(e,t,n){"use strict";n("4de4"),n("d3b7"),n("caad"),n("2532"),n("d81d");var s=n("7a23"),i={class:"content"},o=Object(s["l"])(" Quel(s) utilisateur(s) voulez-vous ajouter ? "),r={class:"users"},c={style:{width:"calc(100% - 85px)"}},a=["onClick"],u={class:"input-user"},d={key:0,id:"friends-list"},l=["value"];function m(e,t,n,m,g,f){return Object(s["y"])(),Object(s["i"])("div",{class:"AddUserInConv",onClick:t[4]||(t[4]=function(){return f.clickEvent&&f.clickEvent.apply(f,arguments)})},[Object(s["j"])("div",i,[o,Object(s["j"])("div",r,[(Object(s["y"])(!0),Object(s["i"])(s["a"],null,Object(s["E"])(g.usersToAdd,(function(e){return Object(s["y"])(),Object(s["i"])("div",{key:e,class:"userInfo"},[Object(s["j"])("div",null,Object(s["K"])(null===e||void 0===e?void 0:e.charAt(0).toUpperCase()),1),Object(s["j"])("span",c,Object(s["K"])(e),1),Object(s["j"])("button",{class:"close",onClick:function(t){return f.removeUser(e)}},"X",8,a)])})),128))]),Object(s["j"])("div",u,[Object(s["j"])("input",{type:"text",placeholder:"Entrez un nom d'utilisateur...",autocomplete:"off",list:"friends-list",name:"name_room",onKeypress:t[0]||(t[0]=function(){return f.isEnter&&f.isEnter.apply(f,arguments)})},null,32),n.showAutocomplete?(Object(s["y"])(),Object(s["i"])("datalist",d,[(Object(s["y"])(!0),Object(s["i"])(s["a"],null,Object(s["E"])(e.getFriends.filter((function(e){return!g.users.map((function(e){return e.username})).includes(e.username)})),(function(e){return Object(s["y"])(),Object(s["i"])("option",{key:e.id,value:e.username},null,8,l)})),128))])):Object(s["h"])("",!0),Object(s["j"])("button",{onClick:t[1]||(t[1]=function(){return f.addUser&&f.addUser.apply(f,arguments)})}," + ")]),Object(s["j"])("button",{class:"submit",onClick:t[2]||(t[2]=function(t){e.$emit("addUsers",g.usersToAdd)})}," Ajouter les utilisateurs séléctionnés ! "),Object(s["j"])("button",{class:"closePopUp",onClick:t[3]||(t[3]=function(t){return e.$emit("desactivatePopUp")})}," X ")])])}var g=n("5530"),f=n("5502"),p=n("bc3a"),h=n.n(p),j={name:"AddUserInConv",props:{showAutocomplete:{required:!0,type:Boolean}},methods:{clickEvent:function(e){"AddUserInConv"===e.target.className&&this.$emit("desactivatePopUp")},addUser:function(){var e=document.querySelector(".input-user > input").value;""===e||this.usersToAdd.includes(e)||this.usersToAdd.push(e),document.querySelector(".input-user > input").value=""},removeUser:function(e){this.usersToAdd=this.usersToAdd.filter((function(t){return t!==e}))},isEnter:function(e){13===e.keyCode&&this.addUser()}},data:function(){return{usersToAdd:[],users:[]}},computed:Object(g["a"])({},Object(f["c"])(["getFriends","getCurrentConv"])),mounted:function(){var e=this;""!==this.getCurrentConv&&h.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data}))}},b=(n("a795"),n("6b0d")),O=n.n(b);const v=O()(j,[["render",m],["__scopeId","data-v-3c631f8d"]]);t["a"]=v},9050:function(e,t,n){"use strict";n.r(t);n("b0c0");var s=n("7a23"),i=function(e){return Object(s["B"])("data-v-3e53c793"),e=e(),Object(s["z"])(),e},o={class:"conv-info"},r={style:{"font-size":"23px","font-weight":"500",color:"#F4F4F4"}},c={class:"top-right-buttons"},a=i((function(){return Object(s["j"])("img",{src:"../assets/pin.png",alt:"",style:{height:"60%"}},null,-1)})),u=[a],d=i((function(){return Object(s["j"])("img",{src:"../assets/user.svg",alt:"",style:{width:"25px"}},null,-1)})),l=[d],m={class:"user-list"},g=i((function(){return Object(s["j"])("span",{style:{"font-size":"18px",color:"#F4F4F4","font-weight":"600","margin-bottom":"10px"}},"Utilisateur(s) de la room :",-1)})),f={key:0,src:"../assets/crown.svg",style:{height:"80%","margin-right":"10px"},alt:""},p=["onClick"],h=i((function(){return Object(s["j"])("img",{src:"../assets/crown.svg",style:{height:"70%"},alt:""},null,-1)})),j=[h],b=["onClick"],O={key:0,class:"pinned-message"},v=i((function(){return Object(s["j"])("br",null,null,-1)})),y=i((function(){return Object(s["j"])("br",null,null,-1)})),C=["onClick"],U={class:"conv-messages"},w={key:0,style:{"align-self":"center","font-size":"15px","font-weight":"500",color:"#F4F4F4"}},_={class:"conv-input"},E=["placeholder"],A={class:"right-side-input"},k=i((function(){return Object(s["j"])("img",{src:"../assets/happy.svg",alt:"Smiley"},null,-1)})),D=[k],I={class:"submit-file",style:{cursor:"pointer"}},M=Object(s["l"])(" + ");function N(e,t,n,i,a,d){var h=Object(s["G"])("w-drawer"),k=Object(s["G"])("AddUser"),N=Object(s["G"])("Message"),S=Object(s["G"])("EmojiPicker");return Object(s["y"])(),Object(s["i"])("div",{class:"ChatContent",key:e.$route.fullPath},[Object(s["j"])("div",o,[Object(s["j"])("div",null,[Object(s["j"])("span",r,Object(s["K"])(e.$route.query.name),1),Object(s["j"])("div",c,[Object(s["j"])("button",{style:Object(s["u"])([a.pinAdd?{animation:""}:{animation:"none"},{height:"100%"}]),onClick:t[0]||(t[0]=function(){return d.switchPinDisplay&&d.switchPinDisplay.apply(d,arguments)})},u,4),Object(s["j"])("button",{style:{color:"#F4F4F4","font-size":"33px","font-weight":"500",height:"100%"},onClick:t[1]||(t[1]=function(e){return a.showAddUser=!0})}," + "),Object(s["j"])("button",{style:{cursor:"pointer"},onClick:t[2]||(t[2]=function(e){a.showUserList=!0})},l),Object(s["m"])(h,{modelValue:a.showUserList,"onUpdate:modelValue":t[3]||(t[3]=function(e){return a.showUserList=e}),right:"",width:"350px","bg-color":"grey-dark5"},{default:Object(s["Q"])((function(){return[Object(s["j"])("div",m,[g,(Object(s["y"])(!0),Object(s["i"])(s["a"],null,Object(s["E"])(a.users,(function(t){return Object(s["y"])(),Object(s["i"])("div",{key:t.id,class:"user"},[t.id===a.roomAdminID?(Object(s["y"])(),Object(s["i"])("img",f)):Object(s["h"])("",!0),Object(s["l"])(" "+Object(s["K"])(t.username)+" ",1),Object(s["j"])("div",null,[t.id!==e.getUser.id&&e.getUser.id===a.roomAdminID?(Object(s["y"])(),Object(s["i"])("button",{key:0,style:{"margin-right":"6px"},onClick:function(e){return d.promoteAdmin(t.id)}},j,8,p)):Object(s["h"])("",!0),e.getUser.id===a.roomAdminID&&t.id!==e.getUser.id&&t.id!==a.roomAdminID?(Object(s["y"])(),Object(s["i"])("button",{key:1,onClick:function(e){return d.removerUser(t.id)}}," X ",8,b)):Object(s["h"])("",!0)])])})),128))])]})),_:1},8,["modelValue"]),a.showAddUser?(Object(s["y"])(),Object(s["g"])(k,{key:0,onAddUsers:d.addUsers,onDesactivatePopUp:t[4]||(t[4]=function(e){a.showAddUser=!1}),"show-autocomplete":!0},null,8,["onAddUsers"])):Object(s["h"])("",!0)]),a.showPinned?(Object(s["y"])(),Object(s["i"])("div",O,[Object(s["j"])("div",null,[Object(s["l"])(Object(s["K"])(0===a.pinned.length?"Aucun message épinglé":"")+" ",1),(Object(s["y"])(!0),Object(s["i"])(s["a"],null,Object(s["E"])(a.pinned,(function(e){return Object(s["y"])(),Object(s["i"])("div",{class:"pinned-message-content",key:e},[Object(s["l"])(Object(s["K"])(e.sender)+" : ",1),v,Object(s["l"])(" "+Object(s["K"])(e.content)+" ",1),y,Object(s["j"])("button",{class:"unpin-message",onClick:function(t){return d.unpinMessage(e.message_id)}}," X ",8,C)])})),128))])])):Object(s["h"])("",!0)])]),Object(s["j"])("div",U,[0===a.messages.length?(Object(s["y"])(),Object(s["i"])("span",w," Soyez le premier à envoyer un message à "+Object(s["K"])(e.$route.query.name),1)):Object(s["h"])("",!0),(Object(s["y"])(!0),Object(s["i"])(s["a"],null,Object(s["E"])(a.messages,(function(t){return Object(s["y"])(),Object(s["g"])(N,{key:t,content:t.content,sender:t.sender,belong_to_myself:t.sender===e.getUser.username,message_date:t.message_date,message_id:t.message_id,edited:t.edited,onPinnedMessage:d.pinnedMessage,onDeletedMessage:d.deletedMessage,onEditedMessage:d.editedMessage},null,8,["content","sender","belong_to_myself","message_date","message_id","edited","onPinnedMessage","onDeletedMessage","onEditedMessage"])})),128))]),Object(s["j"])("div",_,[Object(s["j"])("span",null,Object(s["K"])(d.getWritersAsText()),1),Object(s["j"])("div",null,[Object(s["j"])("input",{type:"text",autocomplete:"off",placeholder:"Envoyer un message à ".concat(e.$route.query.name),onKeydown:t[5]||(t[5]=function(){return d.actionInput&&d.actionInput.apply(d,arguments)})},null,40,E),Object(s["j"])("div",A,[a.showEmoji?(Object(s["y"])(),Object(s["g"])(S,{key:0,onSelectedEmoji:d.insertEmoji,onCloseEmoji:t[6]||(t[6]=function(e){return a.showEmoji=!1}),class:"emojiPicker"},null,8,["onSelectedEmoji"])):Object(s["h"])("",!0),Object(s["j"])("button",{style:{height:"32px",width:"32px"},onClick:t[7]||(t[7]=function(e){return a.showEmoji=!a.showEmoji})},D),Object(s["j"])("label",I,[M,Object(s["j"])("input",{type:"file",ref:"uploadImage",onChange:t[8]||(t[8]=function(e){return d.uploadImage()}),style:{height:"0",width:"0"}},null,544)])])])])])}var S=n("5530"),P=n("2909"),x=n("b85c"),R=n("1da1"),F=(n("96cf"),n("a9e3"),n("d3b7"),n("159b"),n("99af"),n("caad"),n("2532"),n("e9c4"),n("4de4"),n("ac1f"),n("5319"),n("4e82"),n("a434"),n("a1f0"),n("5b81"),n("cc7d")),T=n.n(F),J=n("74d1"),K=n.n(J),q=n("5502"),z=n("bc3a"),G=n.n(z),$=n("0e54"),L=n.n($),B=n("d99d"),V=n("4bdc"),W=n("a289"),X=n("8aef"),H=null,Q={name:"ChatContent",components:{AddUser:X["a"],EmojiPicker:W["a"],Message:B["a"]},data:function(){return{messages:[],users:[],pinned:[],writers:[],showPinned:!1,showEmoji:!1,pinAdd:!1,showAddUser:!1,showUserList:!1,roomAdminID:Number}},mounted:function(){var e=this;this.getMessagesFromJSON(),this.connect(),this.getUserOfRoom(),G.a.get("/api/rooms/findAdminOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.roomAdminID=t.data.id}))},beforeRouteUpdate:function(){var e=this;this.disconnect(),this.getMessagesFromJSON(),this.getUserOfRoom(),this.connect(),G.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data})),G.a.get("/api/rooms/findAdminOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.roomAdminID=t.data.id}))},unmounted:function(){this.disconnect()},methods:{getWritersAsText:function(){var e=this;if(0===this.writers.length)return"";if(1===this.writers.length)return"".concat(this.writers[0]," est en train d'écrire...");if(this.writers.length>4)return"Plusieurs personnes sont en train d'écrire";var t="";return this.writers.forEach((function(n){t+=n===e.writers[e.writers.length-1]?"et ".concat(n):"".concat(n).concat(n===e.writers[e.writers.length-2]?"":","," ")})),"".concat(t," sont en train d'écrire...")},actionInput:function(e){if(13===e.keyCode&&""!==document.querySelector(".conv-input > div > input").value)this.send(),this.writers.pop(this.getUser.username);else if(13!==e.keyCode){this.writing();var t=document.querySelector(".conv-input > div > input");t.value=this.displayMessage(t.value,!1,!0,!1)}},getUserOfRoom:function(){var e=this;G.a.get("/api/rooms/findUserOfRoom?room_id=".concat(this.getCurrentConv)).then((function(t){e.users=t.data}))},writing:function(){this.writers.includes(this.getUser.username)||H.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({sender:this.getUser.username,type:"WRITING"}))},connect:function(){var e=this,t=new T.a("/ws");H=K.a.over(t),H.debug=null,H.connect({},(function(){H.subscribe("/conversations/rooms/".concat(e.getCurrentConv),(function(t){e.onMessageReceived(t)}))}),this.errorCallBack)},disconnect:function(){null!==H&&H.disconnect()},errorCallBack:function(){var e=this;setTimeout((function(){e.connect()}),5e3)},onMessageReceived:function(e){var t=this,n=JSON.parse(e.body);n.sender!==this.getUser.username&&("MESSAGE"===n.type?this.messages.unshift({convUUID:n.convUUID,message_id:n.message_id,content:n.content,sender:n.sender,message_date:n.message_date,pinned:n.pinned,edited:!1}):"WRITING"===n.type?this.writers.includes(n.sender)||(this.writers.push(n.sender),setTimeout((function(){t.writers.pop(n.sender)}),5e3)):"PINNED"===n.type?this.messages.forEach((function(e){e.message_id!==n.message_id||t.pinned.includes(e)||t.pinned.push(e)})):"UNPINNED"===n.type?this.pinned=this.pinned.filter((function(e){return e.message_id!==n.message_id})):"DELETED"===n.type?(this.messages=this.messages.filter((function(e){return e.message_id!==n.message_id})),this.pinned=this.pinned.filter((function(e){return e.message_id!==n.message_id}))):"EDITED"===n.type?(this.messages.forEach((function(e){e.message_id===n.message_id&&(e.content=n.content,e.edited=!0)})),this.pinned.forEach((function(e){e.message_id===n.message_id&&(e.content=n.content,e.edited=!0)}))):"USERS_ADDED"===n.type?(n.users.forEach((function(e){t.containUsername(e)&&G.a.get("/api/users/findByUserName?username=".concat(e)).then((function(e){t.users.push(e.data)}))})),setTimeout((function(){t.getUserOfRoom()}),500),this.showAddUser=!1):"USER_REMOVED"===n.type?(this.users=this.users.filter((function(e){return e.id!==n.user_id})),setTimeout((function(){t.getUserOfRoom()}),500),n.user_id===this.getUser.id&&location.replace("/messages")):"CHANGE_ADMIN"===n.type&&(this.roomAdminID=n.user_id))},send:function(){var e=this,t=document.querySelector(".conv-input > div > input");t&&H&&G.a.post("/api/messages/sendMessage?room_uuid=".concat(this.getCurrentConv),{conv_uuid:this.getCurrentConv,content:t.value,sender:this.getUser.username,message_date:Date.now()}).then((function(n){e.messages.unshift(n.data),H.send("/conversations/rooms/".concat(e.getCurrentConv),{},JSON.stringify(n.data)),t.value=""}))},getMessagesFromJSON:function(){var e=this;G.a.get("/api/messages?room_uuid=".concat(this.getCurrentConv)).then((function(t){e.messages=t.data.sort((function(e,t){return t.message_date-e.message_date})),e.pinned=e.messages.filter((function(e){return!0===e.pinned}))}))},switchPinDisplay:function(){this.showPinned=!this.showPinned},unpinMessage:function(e){var t=this;G.a.put("/api/messages/unpinMessage?message_id=".concat(e)).then((function(){var n=0;t.pinned.forEach((function(s){s.message_id===e&&t.pinned.splice(n,1),n++})),H.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({message_id:e,type:"UNPINNED"}))}))},pinnedMessage:function(e){var t=this;this.messages.forEach((function(n){n.message_id!==e||t.pinned.includes(n)||(H.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({message_id:e,type:"PINNED"})),t.pinned.push(n))}))},deletedMessage:function(e){H.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({message_id:e,type:"DELETED"}))},editedMessage:function(e,t){H.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({message_id:e,content:t,type:"EDITED"}))},addUsers:function(e){var t=this;return Object(R["a"])(regeneratorRuntime.mark((function n(){var s,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:s=Object(x["a"])(e),n.prev=1,s.s();case 3:if((i=s.n()).done){n.next=10;break}if(o=i.value,!t.containUsername(o)){n.next=8;break}return n.next=8,G.a.get("/api/users/findByUserName?username=".concat(o)).then((function(e){G.a.post("/api/rooms/addNewMember?room_id=".concat(t.getCurrentConv,"&user_id=").concat(e.data.id))}));case 8:n.next=3;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](1),s.e(n.t0);case 15:return n.prev=15,s.f(),n.finish(15);case 18:H.send("/conversations/rooms/".concat(t.getCurrentConv),{},JSON.stringify({users:e,type:"USERS_ADDED"}));case 19:case"end":return n.stop()}}),n,null,[[1,12,15,18]])})))()},removerUser:function(e){G.a.delete("/api/rooms/removeMember?room_id=".concat(this.getCurrentConv,"&user_id=").concat(e)),H.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({user_id:e,type:"USER_REMOVED"}))},promoteAdmin:function(e){G.a.put("/api/rooms/changeAdmin?room_id=".concat(this.getCurrentConv,"&admin=").concat(e)),H.send("/conversations/rooms/".concat(this.getCurrentConv),{},JSON.stringify({user_id:e,type:"CHANGE_ADMIN"}))},uploadImage:function(){var e=this,t=this.$refs.uploadImage.files[0],n=new FormData;n.append("file",t),G()({url:"/api/uploadfile/uploadImageInChat?room_id=".concat(this.getCurrentConv),method:"POST",data:n,headers:{Accept:"application/json","Content-type":"multipart/form-data"}}).then((function(t){"L'extension n'est pas un fichier jpg ou png, il ne peut donc pas être upload"!==t.data&&"Erreur lors du téléchargement de l'image !"!==t.data&&G.a.post("/api/messages/sendMessage?room_uuid=".concat(e.getCurrentConv),{conv_uuid:e.getCurrentConv,content:"![".concat("Image de "+e.getUser.username,"](").concat(t.data,")"),sender:e.getUser.username,message_date:Date.now()}).then((function(t){e.messages.unshift(t.data),H.send("/conversations/rooms/".concat(e.getCurrentConv),{},JSON.stringify(t.data))}))}))},filterEmoji:function(e){var t=":[a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*:",n=Object(P["a"])(e.matchAll(t));return n&&n.length>0&&n.forEach((function(t){V["a"][t[0].replaceAll(":","")]&&(e=e.replace(t[0],V["a"][t[0].replaceAll(":","")]))})),e},filterMarkdown:function(e){return L()(e)},filterPing:function(e){return e.includes("@".concat(this.getUser.username))?(this.mention=!0,e.replaceAll("@".concat(this.getUser.username),"@".concat(this.getUser.name))):e},displayMessage:function(e,t,n,s){return s&&(e=this.filterPing(e)),n&&(e=this.filterEmoji(e)),t&&(e=this.filterMarkdown(e)),e},insertEmoji:function(e){document.querySelector(".conv-input > div > input").value+=e},containUsername:function(e){var t=!1;return this.getFriends.forEach((function(n){n.username===e&&(t=!0)})),t}},computed:Object(S["a"])({},Object(q["c"])(["getColors","getCurrentConv","getUser","getFriends"]))},Z=(n("493e"),n("6b0d")),Y=n.n(Z);const ee=Y()(Q,[["render",N],["__scopeId","data-v-3e53c793"]]);t["default"]=ee},a795:function(e,t,n){"use strict";n("a7d2")},a7d2:function(e,t,n){},a981:function(e,t,n){},d81d:function(e,t,n){"use strict";var s=n("23e7"),i=n("b727").map,o=n("1dde"),r=o("map");s({target:"Array",proto:!0,forced:!r},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=:id.f6e688d5.js.map